## toi20_sculpture
[problem statement](https://api.otog.in.th/problem/doc/1015)

<details>
  <summary>hints</summary>
  <ul>
    <details>
      <summary>hint 1</summary>
      <p>คำตอบของเรา/ความสูงของกอง มีค่ามากสุดเท่าไหร่</p>
    </details>
    <details>
      <summary>hint 2</summary>
      <p>ลองคิดแบบจากซ้ายไปขวาเท่านั้นให้ได้ $O(N^3)$ ยังไม่ต้อง solution เต็ม</p>
    </details>
    <details>
      <summary>hint 3</summary>
      <p>ถ้าทำจากหน้าไปหลังเก็บน้ำหนักน้อยสุด ลองคิดดูว่าทำจากหลังไปหน้าแล้วรวมคำตอบได้อย่างไร</p>
    </details>
  </ul>
</details>

<details>
  <summary>prerequisites</summary>
  <p><ins>dp</ins>, longest increasing subsequence</p>
</details>

<details>
  <summary>solution</summary>
  <ul>
    <li>มองจากโจทย์เราสามารถ brute force หา subset ที่มีจำนวนสมาชิกใหญ่ที่สุดและตรงกับเงื่อนไข แต่ทำอย่างนี้จะได้เพียง subtask แรกๆ ทำให้เราต้องเปลี่ยนมุมมองเป็นอย่างอื่น</li>
    <li>เราเห็นว่าการเลือกหินนั้นลำดับมีผลต่อการเลือก ทำให้มองเป็นการหา subsequence ได้ หากมองเป็นการหา LIS โดยปกติแล้วใส่เงื่อนไขอาจเขียนได้ยาก (หรือเป็นไปไม่ได้ ไม่รู้เหมือนกัน T_T) เพราะการเลือกหยิบในอนาคตขึ้นอยู่กับการหยิบในอดีตมากกว่าแค่ตัวล่าสุดต่างจาก LIS ทั่วไป เช่น <code>1 10 2 3 4 5</code> การหยิบ 5 มาต่อ subsequence ที่ลงท้ายด้วย 4 ไม่ได้ขึ้นอยู่กับค่าของเลขก่อนหน้านั้นเลย แต่ในโจทย์ข้อนี้เลขก่อนหน้าส่งผลต่อน้ำหนักรวมที่หินล่าสุดจะต้องรับ</li>
    <li>เราจึงต้องเปลี่ยนมุมมองจาก “ลำดับที่ยาวที่สุดที่จบที่ i” เป็นการหา “น้ำหนักรวมน้อยสุดของกองที่มี k ก้อน” แล้วทำอย่างนี้สำหรับทุก ๆ i และ k นั่นคือ หาว่าสำหรับกองทุกขนาดแล้วน้ำหนักน้อยสุดสำหรับกองขนาดนั้นคือเท่าไหร่ จากนั้นเมื่อเราไปที่หินก้อนใหม่เราก็ดูว่าหินนั้นรับน้ำหนักกองไหนได้บ้าง แล้วก็เอาไปรองต่อกองที่ได้น้ำหนักใหม่ที่ดีขึ้น ใช้เวลา $O(N K)$ และเนื่องจากความสูงแต่ละกอง $K≤N$ จะใช้เวลา $O(N^2)$</li>
    <li>สำหรับเครื่องช่วยรับน้ำหนัก ถ้าเราทำการเลือกแบบตรง ๆ สำหรับทุกหินเราต้องทำ $N$ หิน และคิดแบบด้านบนสำหรับหินที่อยู่ขวาจากหินนั้นใช้เวลาอีก $O(N^2)$ รวมเป็น $O(N^3)$ เนื่องจาก $N≤2 \cdot 10^4$ การทำอย่างนี้จะไม่ทัน</li>
    <li>เราจึงต้องหาทางทำให้เร็วกว่านั้น โดยเราจะพยายามทำจากซ้ายไปขวาและขวาไปซ้ายรอบละ $O(N^2)$ แล้วค่อยรวมคำตอบของแต่ละรอบ (เก็บ prefix กับ suffix แล้วรวมคำตอบ) ในการทำจากขวาไปซ้ายเราจะเก็บ limit ที่เหลือของกองแต่ละขนาดแทนการเก็บน้ำหนักรวม เมื่อเจอหินใหม่เราก็พิจารณาว่าใส่แต่ละกองแล้วจะเกิน limit ไหม ถ้าไม่เกินก็ใส่เข้าไปแล้วเปลี่ยน limit ที่เหลือ หรือดีกว่าที่จะเริ่มกองใหม่</li>
    <li>ทำซ้ายไปขวาและขวาไปซ้ายอย่างละหนึ่งรอบใช้เวลารอบละ $O(N^2)$ แล้วนำคำตอบมารวมโดยพิจารณาแต่ละหินแล้วเอาคำตอบจากด้านซ้ายและขวามารวมกันใช้เวลา $O(N)$ รวมเป็น $O(N^2+N)$ = $O(N^2)$</li>
  </ul>
</details>

[ac code](./toi20_sculpture.cpp)
